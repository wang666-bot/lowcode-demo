!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@formily/json-schema"),require("react-is")):"function"==typeof define&&define.amd?define("formily.react",["exports","@formily/json-schema","react-is"],r):r(((e="undefined"!=typeof globalThis?globalThis:e||self).Formily=e.Formily||{},e.Formily.React={}),e.Formily.JSONSchema)}(this,(function(e,r){"use strict";!function(){const e={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();var t=function(e){return Formily.ReactiveReact.unstable_useCompatEffect((function(){return e.onMount(),function(){return e.onUnmount()}}),[e]),e},n=React.createContext(null),a=React.createContext(null),o=React.createContext(null),l=React.createContext(null),i=React.createContext(null),c=React.createContext(null),u=React.createContext(null),d=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(r){var t=r.children;return e.reduce((function(e,r){return React.createElement(r.Provider,{value:void 0},e)}),t)}}(a,o,l,i,c,u),m=function(){return m=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},m.apply(this,arguments)};function s(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,a,o=t.call(e),l=[];try{for(;(void 0===r||r-- >0)&&!(n=o.next()).done;)l.push(n.value)}catch(e){a={error:e}}finally{try{n&&!n.done&&(t=o.return)&&t.call(o)}finally{if(a)throw a.error}}return l}function p(e,r,t){if(t||2===arguments.length)for(var n,a=0,o=r.length;a<o;a++)!n&&a in r||(n||(n=Array.prototype.slice.call(r,0,a)),n[a]=r[a]);return e.concat(n||Array.prototype.slice.call(r))}"function"==typeof SuppressedError&&SuppressedError;var v=function(){return React.useContext(n)},y=function(){return React.useContext(a)},f=function(){return React.useContext(i)};const h=ReactIs;var F={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},R={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},P={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},b={};function g(e){return h.isMemo(e)?P:b[e.$$typeof]||F}b[h.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},b[h.Memo]=P;var E=Object.defineProperty,S=Object.getOwnPropertyNames,O=Object.getOwnPropertySymbols,C=Object.getOwnPropertyDescriptor,x=Object.getPrototypeOf,N=Object.prototype;var j=function e(r,t,n){if("string"!=typeof t){if(N){var a=x(t);a&&a!==N&&e(r,a,n)}var o=S(t);O&&(o=o.concat(O(t)));for(var l=g(r),i=g(t),c=0;c<o.length;++c){var u=o[c];if(!(R[u]||n&&n[u]||i&&i[u]||l&&l[u])){var d=C(t,u);try{E(r,u,d)}catch(e){}}}}return r};const T=Formily.ReactiveReact.observer,M=Formily.ReactiveReact.Observer;var V=function(e){var r=t(e.form);return React.createElement(d,null,React.createElement(n.Provider,{value:r},e.children))};V.displayName="FormProvider";var D=Formily.ReactiveReact.observer((function(e){var r=Formily.Shared.isFn(e.children)?e.children(v()):null;return React.createElement(React.Fragment,null,r)}));D.displayName="FormConsumer";var $=function(e,r,t){return Formily.Shared.isFn(e)?e(r,t):e},I=function(e){var r,t=React.useContext(c);if(!e.field)return React.createElement(React.Fragment,null,$(e.children));var n=e.field,a=function(e,r){if((e||r)&&!Formily.Shared.isFn(e))return React.createElement(React.Fragment,null,e,r)}($(e.children,n,n.form),null!==(r=n.content)&&void 0!==r?r:n.componentProps.children);if("visible"!==n.display)return null;var o,l=function(e){var r;return function(e){return e&&("object"==typeof e||"function"==typeof e)}(e)?e:null!==(r=Formily.Shared.FormPath.getIn(t,e))&&void 0!==r?r:e};return o=function(){var e,r,t;if(!n.componentType)return a;var o=Formily.Core.isVoidField(n)?void 0:n.value,i=Formily.Core.isVoidField(n)?null===(e=n.componentProps)||void 0===e?void 0:e.onChange:function(){for(var e,r,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];n.onInput.apply(n,p([],s(t),!1)),null===(r=null===(e=n.componentProps)||void 0===e?void 0:e.onChange)||void 0===r||r.call.apply(r,p([e],s(t),!1))},c=Formily.Core.isVoidField(n)?null===(r=n.componentProps)||void 0===r?void 0:r.onFocus:function(){for(var e,r,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];n.onFocus.apply(n,p([],s(t),!1)),null===(r=null===(e=n.componentProps)||void 0===e?void 0:e.onFocus)||void 0===r||r.call.apply(r,p([e],s(t),!1))},u=Formily.Core.isVoidField(n)?null===(t=n.componentProps)||void 0===t?void 0:t.onBlur:function(){for(var e,r,t=[],a=0;a<arguments.length;a++)t[a]=arguments[a];n.onBlur.apply(n,p([],s(t),!1)),null===(r=null===(e=n.componentProps)||void 0===e?void 0:e.onBlur)||void 0===r||r.call.apply(r,p([e],s(t),!1))},d=Formily.Core.isVoidField(n)?void 0:"disabled"===n.pattern||"readPretty"===n.pattern,v=Formily.Core.isVoidField(n)?void 0:"readOnly"===n.pattern;return React.createElement(l(n.componentType),m(m({disabled:d,readOnly:v},Formily.Reactive.toJS(n.componentProps)),{value:o,onChange:i,onFocus:c,onBlur:u}),a)}(),n.decoratorType?React.createElement(l(n.decoratorType),Formily.Reactive.toJS(n.decoratorProps),o):React.createElement(React.Fragment,null,o)};I.displayName="ReactiveField";var w=Formily.ReactiveReact.observer(I,{forwardRef:!0}),A=function(e){var r=v(),n=y(),o=t(r.createArrayField(m({basePath:null==n?void 0:n.address},e)));return React.createElement(a.Provider,{value:o},React.createElement(w,{field:o},e.children))};A.displayName="ArrayField";var k=function(e){var r=v(),n=y(),o=t(r.createObjectField(m({basePath:null==n?void 0:n.address},e)));return React.createElement(a.Provider,{value:o},React.createElement(w,{field:o},e.children))};k.displayName="ObjectField";var _=function(e){var r=v(),n=y(),o=t(r.createVoidField(m({basePath:null==n?void 0:n.address},e)));return React.createElement(a.Provider,{value:o},React.createElement(w,{field:o},e.children))};_.displayName="VoidField";var B=function(e){var r=v(),t=y(),n=r.createField(m({basePath:null==t?void 0:t.address},e));return React.useEffect((function(){return null==n||n.onMount(),function(){null==n||n.onUnmount()}}),[n]),React.createElement(a.Provider,{value:n},React.createElement(w,{field:n},e.children))};B.displayName="Field";var J,z,q,U=function(e){var r,t,n=function(e){var r=y();return e.onlyRenderProperties?e.basePath||(null==r?void 0:r.address.concat(e.name)):e.basePath||(null==r?void 0:r.address)}(e),a=React.useMemo((function(){return new Formily.JSONSchema.Schema(e.schema)}),[e.schema]),o=(r=a,t=f(),r.toFieldProps({scope:t})),i=function(r){if(!e.onlyRenderSelf){var t=Formily.JSONSchema.Schema.getOrderProperties(a);if(t.length)return React.createElement(React.Fragment,null,t.map((function(t,a){var o=t.schema,l=t.key,i=(null==r?void 0:r.address)||n,c=o;if(Formily.Shared.isFn(e.mapProperties)){var u=e.mapProperties(o,l);u&&(c=u)}return Formily.Shared.isFn(e.filterProperties)&&!1===e.filterProperties(c,l)?null:Formily.Shared.isBool(e.propsRecursion)&&e.propsRecursion?React.createElement(U,{propsRecursion:!0,filterProperties:e.filterProperties,mapProperties:e.mapProperties,schema:c,key:"".concat(a,"-").concat(l),name:l,basePath:i}):React.createElement(U,{schema:c,key:"".concat(a,"-").concat(l),name:l,basePath:i})})))}};return a?React.createElement(l.Provider,{value:a},Formily.Shared.isValid(e.name)?"object"===a.type?e.onlyRenderProperties?i():React.createElement(k,m({},o,{name:e.name,basePath:n}),i):"array"===a.type?React.createElement(A,m({},o,{name:e.name,basePath:n})):"void"===a.type?e.onlyRenderProperties?i():React.createElement(_,m({},o,{name:e.name,basePath:n}),i):React.createElement(B,m({},o,{name:e.name,basePath:n})):i()):React.createElement(React.Fragment,null)},L=function(e){var r=React.useContext(i);return React.createElement(i.Provider,{value:Formily.Shared.lazyMerge(r,e.value)},e.children)},G={portalDOM:null===(z=null===(J=null===Formily.Shared.globalThisPolyfill||void 0===Formily.Shared.globalThisPolyfill?void 0:Formily.Shared.globalThisPolyfill.document)||void 0===J?void 0:J.createElement)||void 0===z?void 0:z.call(J,"div"),createPortal:null===(q=null===Formily.Shared.globalThisPolyfill||void 0===Formily.Shared.globalThisPolyfill?void 0:Formily.Shared.globalThisPolyfill.ReactDOM)||void 0===q?void 0:q.createPortal};!function(){var e,r;if(!G.createPortal)try{null!==(e=G.createPortal)&&void 0!==e||(G.createPortal=null===(r=require("react-dom"))||void 0===r?void 0:r.createPortal)}catch(e){}if(!G.createPortal)try{Promise.resolve(ReactDOM).then((function(e){var r;return null!==(r=G.createPortal)&&void 0!==r?r:G.createPortal=null==e?void 0:e.createPortal})).catch()}catch(e){}}();var H={nonameId:0};e.ArrayField=A,e.ContextCleaner=d,e.ExpressionScope=L,e.Field=B,e.FieldContext=a,e.FormConsumer=D,e.FormContext=n,e.FormProvider=V,e.ObjectField=k,e.Observer=M,e.RecordScope=function(e){var r=f();return React.createElement(L,{value:{get $lookup(){return null==r?void 0:r.$record},get $record(){var t,n=null===(t=e.getRecord)||void 0===t?void 0:t.call(e);return"object"==typeof n?Formily.Shared.lazyMerge(n,{get $lookup(){return null==r?void 0:r.$record},get $index(){var r;return null===(r=e.getIndex)||void 0===r?void 0:r.call(e)}}):n},get $index(){var r;return null===(r=e.getIndex)||void 0===r?void 0:r.call(e)}}},e.children)},e.RecordsScope=function(e){return React.createElement(L,{value:{get $records(){var r,t;return null!==(t=null===(r=e.getRecords)||void 0===r?void 0:r.call(e))&&void 0!==t?t:[]}}},e.children)},e.RecursionField=U,e.SchemaComponentsContext=c,e.SchemaContext=l,e.SchemaExpressionScopeContext=i,e.SchemaMarkupContext=o,e.SchemaOptionsContext=u,e.VoidField=_,e.connect=function(e){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];var n=r.reduce((function(e,r){return r(e)}),e),a=React.forwardRef((function(e,r){return React.createElement(n,m(m({},e),{ref:r}))}));return e&&j(a,e),a},e.createSchemaField=function(e){function r(r){var t=Formily.JSONSchema.Schema.isSchemaInstance(r.schema)?r.schema:new Formily.JSONSchema.Schema(m({type:"object"},r.schema));return React.createElement(u.Provider,{value:e},React.createElement(c.Provider,{value:Formily.Shared.lazyMerge(e.components,r.components)},React.createElement(L,{value:Formily.Shared.lazyMerge(e.scope,r.scope)},(H.nonameId=0,r.schema?null:function(e){var r;return"ReactNative"===(null===(r=Formily.Shared.globalThisPolyfill.navigator)||void 0===r?void 0:r.product)?null:G.portalDOM&&G.createPortal?G.createPortal(e,G.portalDOM):React.createElement("template",{},e)}(React.createElement(o.Provider,{value:t},r.children))),React.createElement(U,m({},r,{schema:t})))))}function t(e){var r=React.useContext(o);if(!r)return React.createElement(React.Fragment,null);var t=function(){return React.createElement(React.Fragment,null,e.children)};if("object"===r.type||"void"===r.type){var n=r.addProperty(e.name,e);return React.createElement(o.Provider,{value:n},t())}if("array"===r.type){n=function(t){var n=r.items;return n&&n.name!==e.name?r.addProperty(e.name,t):r.setItems(t)}(e);return React.createElement(o.Provider,{value:Array.isArray(n)?n[0]:n},e.children)}return t()}function n(e){return React.createElement(t,m({},e,{name:e.name||"NO_NAME_FIELD_$".concat(H.nonameId++)}))}function a(e){return React.createElement(n,m({},e,{type:"string"}))}function l(e){return React.createElement(n,m({},e,{type:"object"}))}function i(e){return React.createElement(n,m({},e,{type:"array"}))}function d(e){return React.createElement(n,m({},e,{type:"boolean"}))}function s(e){return React.createElement(n,m({},e,{type:"number"}))}function p(e){return React.createElement(n,m({},e,{type:"date"}))}function v(e){return React.createElement(n,m({},e,{type:"datetime"}))}function y(e){return React.createElement(n,m({},e,{type:"void"}))}return void 0===e&&(e={}),r.displayName="SchemaField",n.displayName="MarkupField",a.displayName="StringField",l.displayName="ObjectField",i.displayName="ArrayField",d.displayName="BooleanField",s.displayName="NumberField",p.displayName="DateField",v.displayName="DateTimeField",y.displayName="VoidField",r.Markup=n,r.String=a,r.Object=l,r.Array=i,r.Boolean=d,r.Date=p,r.DateTime=v,r.Void=y,r.Number=s,r},e.mapProps=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(r){return Formily.ReactiveReact.observer((function(t){var n=y(),a=e.reduce((function(e,r){return Formily.Shared.isFn(r)?e=Object.assign(e,r(e,n)):Formily.Shared.each(r,(function(r,t){var a=Formily.Shared.FormPath.getIn(n,t),o=Formily.Shared.isStr(r)?r:t,l=Formily.Shared.FormPath.getIn(e,o);"value"===t&&r!==t&&delete e.value,Formily.Shared.isValid(l)&&!Formily.Shared.isValid(a)||Formily.Shared.FormPath.setIn(e,o,a)})),e}),m({},t));return React.createElement(r,a)}),{forwardRef:!0})}},e.mapReadPretty=function(e,r){return function(t){return Formily.ReactiveReact.observer((function(n){var a=y();return Formily.Core.isVoidField(a)||"readPretty"!==(null==a?void 0:a.pattern)?React.createElement(t,n):React.createElement(e,m(m({},r),n))}),{forwardRef:!0})}},e.observer=T,e.useExpressionScope=f,e.useField=y,e.useFieldSchema=function(){return React.useContext(l)},e.useForm=v,e.useFormEffects=function(e){var r=v();Formily.ReactiveReact.unstable_useCompatFactory((function(){var t=Formily.Shared.uid();return r.addEffects(t,e),{dispose:function(){r.removeEffects(t)}}}))},e.useParentForm=function(){var e=y(),r=v(),t=function(e){return e?Formily.Core.isObjectField(e)?e:t(null==e?void 0:e.parent):r};return t(e)},Object.keys(r).forEach((function(t){"default"===t||e.hasOwnProperty(t)||Object.defineProperty(e,t,{enumerable:!0,get:function(){return r[t]}})})),Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=formily.react.umd.production.js.map
