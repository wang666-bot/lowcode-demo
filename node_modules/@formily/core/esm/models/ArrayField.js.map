{"version":3,"file":"ArrayField.js","sourceRoot":"","sources":["../../src/models/ArrayField.ts"],"names":[],"mappings":"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","sourcesContent":["import { isArr, move } from '@formily/shared'\nimport { action, reaction } from '@formily/reactive'\nimport {\n  spliceArrayState,\n  exchangeArrayState,\n  cleanupArrayChildren,\n} from '../shared/internals'\nimport { Field } from './Field'\nimport { Form } from './Form'\nimport { JSXComponent, IFieldProps, FormPathPattern } from '../types'\n\nexport class ArrayField<\n  Decorator extends JSXComponent = any,\n  Component extends JSXComponent = any\n> extends Field<Decorator, Component, any, any[]> {\n  displayName = 'ArrayField'\n\n  constructor(\n    address: FormPathPattern,\n    props: IFieldProps<Decorator, Component>,\n    form: Form,\n    designable: boolean\n  ) {\n    super(address, props, form, designable)\n    this.makeAutoCleanable()\n  }\n\n  protected makeAutoCleanable() {\n    this.disposers.push(\n      reaction(\n        () => this.value?.length,\n        (newLength, oldLength) => {\n          if (oldLength && !newLength) {\n            cleanupArrayChildren(this, 0)\n          } else if (newLength < oldLength) {\n            cleanupArrayChildren(this, newLength)\n          }\n        }\n      )\n    )\n  }\n\n  push = (...items: any[]) => {\n    return action(() => {\n      if (!isArr(this.value)) {\n        this.value = []\n      }\n      this.value.push(...items)\n      return this.onInput(this.value)\n    })\n  }\n\n  pop = () => {\n    if (!isArr(this.value)) return\n    return action(() => {\n      const index = this.value.length - 1\n      spliceArrayState(this, {\n        startIndex: index,\n        deleteCount: 1,\n      })\n      this.value.pop()\n      return this.onInput(this.value)\n    })\n  }\n\n  insert = (index: number, ...items: any[]) => {\n    return action(() => {\n      if (!isArr(this.value)) {\n        this.value = []\n      }\n      if (items.length === 0) {\n        return\n      }\n      spliceArrayState(this, {\n        startIndex: index,\n        insertCount: items.length,\n      })\n      this.value.splice(index, 0, ...items)\n      return this.onInput(this.value)\n    })\n  }\n\n  remove = (index: number) => {\n    if (!isArr(this.value)) return\n    return action(() => {\n      spliceArrayState(this, {\n        startIndex: index,\n        deleteCount: 1,\n      })\n      this.value.splice(index, 1)\n      return this.onInput(this.value)\n    })\n  }\n\n  shift = () => {\n    if (!isArr(this.value)) return\n    return action(() => {\n      this.value.shift()\n      return this.onInput(this.value)\n    })\n  }\n\n  unshift = (...items: any[]) => {\n    return action(() => {\n      if (!isArr(this.value)) {\n        this.value = []\n      }\n      spliceArrayState(this, {\n        startIndex: 0,\n        insertCount: items.length,\n      })\n      this.value.unshift(...items)\n      return this.onInput(this.value)\n    })\n  }\n\n  move = (fromIndex: number, toIndex: number) => {\n    if (!isArr(this.value)) return\n    if (fromIndex === toIndex) return\n    return action(() => {\n      move(this.value, fromIndex, toIndex)\n      exchangeArrayState(this, {\n        fromIndex,\n        toIndex,\n      })\n      return this.onInput(this.value)\n    })\n  }\n\n  moveUp = (index: number) => {\n    if (!isArr(this.value)) return\n    return this.move(index, index - 1 < 0 ? this.value.length - 1 : index - 1)\n  }\n\n  moveDown = (index: number) => {\n    if (!isArr(this.value)) return\n    return this.move(index, index + 1 >= this.value.length ? 0 : index + 1)\n  }\n}\n"]}