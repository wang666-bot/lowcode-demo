!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("formily.grid",["exports"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Formily=e.Formily||{},e.Formily.Grid={}))}(this,(function(e){"use strict";!function(){const e={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();var t=function(){return t=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var o in t=arguments[i])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};"function"==typeof SuppressedError&&SuppressedError;var i,n=function(e){return 1===e.nodeType},o=function(){function e(e){var i=this;this.childList=[],this.handler=function(e){e.forEach((function(e){"childList"===e.type&&(e.addedNodes.forEach((function(e){n(e)&&i.addObserver(e)})),e.removedNodes.forEach((function(e){n(e)&&i.removeObserver(e)})))})),i.callback(e,i.observer)},this.observe=function(e,n){i.init=n,i.observeChildList(e),i.observer.observe(e,t(t({},i.init),{subtree:!1,childList:!0,characterData:!1,characterDataOldValue:!1,attributeOldValue:!1}))},this.disconnect=function(){i.observer.disconnect()},this.callback=e,this.observer=new MutationObserver(this.handler)}return e.prototype.observeChildList=function(e){var t=this;Array.from(e.children).forEach((function(e){t.addObserver(e)}))},e.prototype.addObserver=function(e){var i=this;if(!this.childList.find((function(t){return t.element===e}))){var n=this.childList.length,o={element:e,observer:new MutationObserver(this.callback),dispose:function(){o.observer&&(o.observer.disconnect(),delete o.observer,i.childList.splice(n,1))}};o.observer.observe(o.element,t(t({},this.init),{subtree:!1,childList:!1,characterData:!1,characterDataOldValue:!1,attributeOldValue:!1})),this.childList.push(o)}},e.prototype.removeObserver=function(e){var t,i=this.childList.find((function(t){return t.element===e}));i&&(null===(t=i.dispose)||void 0===t||t.call(i))},e}(),r=[],s="ResizeObserver loop completed with undelivered notifications.";!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}(i||(i={}));var a,c=function(e){return Object.freeze(e)},u=function(e,t){this.inlineSize=e,this.blockSize=t,c(this)},l=function(){function e(e,t,i,n){return this.x=e,this.y=t,this.width=i,this.height=n,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,c(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),h=function(e){return e instanceof SVGElement&&"getBBox"in e},d=function(e){if(h(e)){var t=e.getBBox(),i=t.width,n=t.height;return!i&&!n}var o=e,r=o.offsetWidth,s=o.offsetHeight;return!(r||s||e.getClientRects().length)},p=function(e){var t,i;if(e instanceof Element)return!0;var n=null===(i=null===(t=e)||void 0===t?void 0:t.ownerDocument)||void 0===i?void 0:i.defaultView;return!!(n&&e instanceof n.Element)},f="undefined"!=typeof window?window:{},v=new WeakMap,b=/auto|scroll/,m=/^tb|vertical/,g=/msie|trident/i.test(f.navigator&&f.navigator.userAgent),y=function(e){return parseFloat(e||"0")},w=function(e,t,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===i&&(i=!1),new u((i?t:e)||0,(i?e:t)||0)},x=c({devicePixelContentBoxSize:w(),borderBoxSize:w(),contentBoxSize:w(),contentRect:new l(0,0,0,0)}),O=function(e,t){if(void 0===t&&(t=!1),v.has(e)&&!t)return v.get(e);if(d(e))return v.set(e,x),x;var i=getComputedStyle(e),n=h(e)&&e.ownerSVGElement&&e.getBBox(),o=!g&&"border-box"===i.boxSizing,r=m.test(i.writingMode||""),s=!n&&b.test(i.overflowY||""),a=!n&&b.test(i.overflowX||""),u=n?0:y(i.paddingTop),p=n?0:y(i.paddingRight),f=n?0:y(i.paddingBottom),O=n?0:y(i.paddingLeft),C=n?0:y(i.borderTopWidth),T=n?0:y(i.borderRightWidth),R=n?0:y(i.borderBottomWidth),E=O+p,S=u+f,F=(n?0:y(i.borderLeftWidth))+T,z=C+R,B=a?e.offsetHeight-z-e.clientHeight:0,W=s?e.offsetWidth-F-e.clientWidth:0,k=o?E+F:0,P=o?S+z:0,M=n?n.width:y(i.width)-k-W,j=n?n.height:y(i.height)-P-B,A=M+E+W+F,G=j+S+B+z,N=c({devicePixelContentBoxSize:w(Math.round(M*devicePixelRatio),Math.round(j*devicePixelRatio),r),borderBoxSize:w(A,G,r),contentBoxSize:w(M,j,r),contentRect:new l(O,u,M,j)});return v.set(e,N),N},C=function(e,t,n){var o=O(e,n),r=o.borderBoxSize,s=o.contentBoxSize,a=o.devicePixelContentBoxSize;switch(t){case i.DEVICE_PIXEL_CONTENT_BOX:return a;case i.BORDER_BOX:return r;default:return s}},T=function(e){var t=O(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=c([t.borderBoxSize]),this.contentBoxSize=c([t.contentBoxSize]),this.devicePixelContentBoxSize=c([t.devicePixelContentBoxSize])},R=function(e){if(d(e))return 1/0;for(var t=0,i=e.parentNode;i;)t+=1,i=i.parentNode;return t},E=function(){var e=1/0,t=[];r.forEach((function(i){if(0!==i.activeTargets.length){var n=[];i.activeTargets.forEach((function(t){var i=new T(t.target),o=R(t.target);n.push(i),t.lastReportedSize=C(t.target,t.observedBox),o<e&&(e=o)})),t.push((function(){i.callback.call(i.observer,n,i.observer)})),i.activeTargets.splice(0,i.activeTargets.length)}}));for(var i=0,n=t;i<n.length;i++){(0,n[i])()}return e},S=function(e){r.forEach((function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((function(i){i.isActive()&&(R(i.target)>e?t.activeTargets.push(i):t.skippedTargets.push(i))}))}))},F=function(){var e,t=0;for(S(t);r.some((function(e){return e.activeTargets.length>0}));)t=E(),S(t);return r.some((function(e){return e.skippedTargets.length>0}))&&("function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:s}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=s),window.dispatchEvent(e)),t>0},z=[],B=function(e){if(!a){var t=0,i=document.createTextNode("");new MutationObserver((function(){return z.splice(0).forEach((function(e){return e()}))})).observe(i,{characterData:!0}),a=function(){i.textContent=""+(t?t--:t++)}}z.push(e),a()},W=0,k={attributes:!0,characterData:!0,childList:!0,subtree:!0},P=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],M=function(e){return void 0===e&&(e=0),Date.now()+e},j=!1,A=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!j){j=!0;var i,n=M(e);i=function(){var i=!1;try{i=F()}finally{if(j=!1,e=n-M(),!W)return;i?t.run(1e3):e>0?t.run(e):t.start()}},B((function(){requestAnimationFrame(i)}))}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,k)};document.body?t():f.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),P.forEach((function(t){return f.addEventListener(t,e.listener,!0)})))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),P.forEach((function(t){return f.removeEventListener(t,e.listener,!0)})),this.stopped=!0)},e}()),G=function(e){!W&&e>0&&A.start(),!(W+=e)&&A.stop()},N=function(){function e(e,t){this.target=e,this.observedBox=t||i.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=C(this.target,this.observedBox,!0);return e=this.target,h(e)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(e)||"inline"!==getComputedStyle(e).display||(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),L=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},D=new WeakMap,V=function(e,t){for(var i=0;i<e.length;i+=1)if(e[i].target===t)return i;return-1},_=function(){function e(){}return e.connect=function(e,t){var i=new L(e,t);D.set(e,i)},e.observe=function(e,t,i){var n=D.get(e),o=0===n.observationTargets.length;V(n.observationTargets,t)<0&&(o&&r.push(n),n.observationTargets.push(new N(t,i&&i.box)),G(1),A.schedule())},e.unobserve=function(e,t){var i=D.get(e),n=V(i.observationTargets,t),o=1===i.observationTargets.length;n>=0&&(o&&r.splice(r.indexOf(i),1),i.observationTargets.splice(n,1),G(-1))},e.disconnect=function(e){var t=this,i=D.get(e);i.observationTargets.slice().forEach((function(i){return t.unobserve(e,i.target)})),i.activeTargets.splice(0,i.activeTargets.length)},e}(),I=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");_.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!p(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");_.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!p(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");_.unobserve(this,e)},e.prototype.disconnect=function(){_.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}(),X=/span\s*(\d+)/,q=function(e,t){return void 0===t&&(t=!1),e.reduce((function(e,i){var n;return t||i.visible?-1===i.originSpan?e+(null!==(n=i.span)&&void 0!==n?n:1):e+i.span:e}),0)},H=function(e,t){return void 0===t&&(t=!1),e.reduce((function(e,i){var n;return t||i.visible?-1===i.originSpan?e+(null!==(n=i.span)&&void 0!==n?n:1):e+i.originSpan:e}),0)},J=function(e,t,i,n,o,r){for(var s=[],a=i;a<=t;a++){var c=e-(a-1)*r,u=c/a;u>=o&&u<=n?s.push(a):u<o?s.push(Math.min(Math.floor(c/o),t)):u>n&&s.push(Math.min(Math.floor(c/n),t))}return Math.max.apply(Math,function(e,t,i){if(i||2===arguments.length)for(var n,o=0,r=t.length;o<r;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}([],function(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,o,r=i.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s}(s),!1))},U=function(e){var t,i;return Number(null!==(i=null===(t=String(e).match(X))||void 0===t?void 0:t[1])&&void 0!==i?i:1)},Y=function(e,t){return function(e){return null!=e}(e)?function(e,t){var i;return Array.isArray(e)?-1===t?e[0]:null!==(i=e[t])&&void 0!==i?i:e[e.length-1]:e}(e,t.breakpoint):e},K=function(e){return Promise.resolve(0).then(e)},Q=function(){function e(e){var i=this;this.width=0,this.height=0,this.children=[],this.childTotalColumns=0,this.shadowChildTotalColumns=0,this.childOriginTotalColumns=0,this.shadowChildOriginTotalColumns=0,this.ready=!1,this.connect=function(e){if(e){i.container=e;var n=Formily.Reactive.batch.bound((function(){r(),i.ready=!0})),r=Formily.Reactive.batch.bound((function(){var e;i.children=(e=i.container.children,Array.from(e).reduce((function(e,t,i){var n,o=getComputedStyle(t),r=!("none"===o.display),s=t.getAttribute("data-grid-span"),a=null!==(n=U(o.gridColumnStart))&&void 0!==n?n:1,c={index:i,span:a,visible:r,originSpan:Number(null!=s?s:a),element:t};return s||t.setAttribute("data-grid-span",String(a)),e.concat(c)}),[])),i.childTotalColumns=q(i.children),i.shadowChildTotalColumns=q(i.children,!0),i.childOriginTotalColumns=H(i.children),i.shadowChildOriginTotalColumns=H(i.children,!0);var t,n,o,r,s,a=i.container.getBoundingClientRect();a.width&&a.height&&(i.width=a.width,i.height=a.height),n=0,o=0,r=0,s=0,(t=i).ready&&(t.children=t.children.map((function(e){var i,a=n%t.columns,c=o%t.columns,u=t.columns-a,l=e.originSpan,h=l>t.columns?t.columns:l,d=t.options.strictAutoFit?h:h>u?u:h,p=-1===l?"span ".concat(u," / -1"):"span ".concat(d," / auto");return e.element.style.gridColumn!==p&&(e.element.style.gridColumn=p),e.visible&&(n+=d),o+=d,0===a&&r++,0==c&&s++,e.shadowRow=s,e.shadowColumn=c+1,e.visible&&(e.row=r,e.column=a+1),(null===(i=t.options)||void 0===i?void 0:i.shouldVisible)&&(t.options.shouldVisible(e,t)?(e.visible||(e.element.style.display=""),e.visible=!0):(e.visible&&(e.element.style.display="none"),e.visible=!1)),e}))),K((function(){var e,t;null===(t=null===(e=i.options)||void 0===e?void 0:e.onDigest)||void 0===t||t.call(e,i)})),i.ready||K((function(){var e,t;null===(t=null===(e=i.options)||void 0===e?void 0:e.onInitialized)||void 0===t||t.call(e,i)}))})),s=new o(r),a=new I(r),c=Formily.Reactive.reaction((function(){return t({},i.options)}),r);return a.observe(i.container),s.observe(i.container,{attributeFilter:["data-grid-span"],attributes:!0}),n(),function(){a.unobserve(i.container),a.disconnect(),s.disconnect(),c(),i.children=[]}}return function(){}},this.options=t({breakpoints:[720,1280,1920],columnGap:8,rowGap:4,minWidth:100,colWrap:!0,strictAutoFit:!1},e),Formily.Reactive.define(this,{options:Formily.Reactive.observable.shallow,width:Formily.Reactive.observable.ref,height:Formily.Reactive.observable.ref,ready:Formily.Reactive.observable.ref,children:Formily.Reactive.observable.ref,childOriginTotalColumns:Formily.Reactive.observable.ref,shadowChildOriginTotalColumns:Formily.Reactive.observable.ref,shadowChildTotalColumns:Formily.Reactive.observable.ref,childTotalColumns:Formily.Reactive.observable.ref,columns:Formily.Reactive.observable.computed,templateColumns:Formily.Reactive.observable.computed,gap:Formily.Reactive.observable.computed,maxColumns:Formily.Reactive.observable.computed,minColumns:Formily.Reactive.observable.computed,maxWidth:Formily.Reactive.observable.computed,minWidth:Formily.Reactive.observable.computed,breakpoints:Formily.Reactive.observable.computed,breakpoint:Formily.Reactive.observable.computed,rowGap:Formily.Reactive.observable.computed,columnGap:Formily.Reactive.observable.computed,colWrap:Formily.Reactive.observable.computed})}return Object.defineProperty(e.prototype,"breakpoints",{get:function(){return this.options.breakpoints},set:function(e){this.options.breakpoints=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"breakpoint",{get:function(){return function(e,t){if(Array.isArray(e))for(var i=0;i<e.length;i++)if(t<=e[i])return i;return-1}(this.options.breakpoints,this.width)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){var e;return null!==(e=Y(this.options.maxWidth,this))&&void 0!==e?e:1/0},set:function(e){this.options.maxWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minWidth",{get:function(){var e;return null!==(e=Y(this.options.minWidth,this))&&void 0!==e?e:100},set:function(e){this.options.minWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxColumns",{get:function(){var e;return null!==(e=Y(this.options.maxColumns,this))&&void 0!==e?e:1/0},set:function(e){this.options.maxColumns=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxRows",{get:function(){var e;return null!==(e=this.options.maxRows)&&void 0!==e?e:1/0},set:function(e){this.options.maxRows=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minColumns",{get:function(){var e;return null!==(e=Y(this.options.minColumns,this))&&void 0!==e?e:1},set:function(e){this.options.minColumns=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowGap",{get:function(){var e;return null!==(e=Y(this.options.rowGap,this))&&void 0!==e?e:5},set:function(e){this.options.rowGap=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columnGap",{get:function(){var e;return null!==(e=Y(this.options.columnGap,this))&&void 0!==e?e:10},set:function(e){this.options.columnGap=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colWrap",{get:function(){var e;return null===(e=Y(this.options.colWrap,this))||void 0===e||e},set:function(e){this.options.colWrap=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){if(!this.ready)return 0;var e=this.childOriginTotalColumns;if(!1===this.colWrap)return e;var t=this.childSize,i=Math.round(this.width/(this.maxWidth+this.columnGap)),n=Math.min(e,i),o=this.options.strictAutoFit?i:n,r=Math.round(this.width/(this.minWidth+this.columnGap)),s=Math.min(e,r),a=this.options.strictAutoFit?r:s,c=Math.min(t,e,o,a),u=Math.max(t,e,o,a),l=J(this.width,u,c,this.maxWidth,this.minWidth,this.columnGap);return l>=this.maxColumns?this.maxColumns:l<=this.minColumns?this.minColumns:l},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return Math.ceil(this.childTotalColumns/this.columns)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shadowRows",{get:function(){return Math.ceil(this.shadowChildTotalColumns/this.columns)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"templateColumns",{get:function(){if(!this.width)return"";if(this.maxWidth===1/0)return"repeat(".concat(this.columns,",minmax(0,1fr))");if(!0!==this.options.strictAutoFit){var e=(this.width-(this.columns-1)*this.columnGap)/this.columns;if(e<this.minWidth||e>this.maxWidth)return"repeat(".concat(this.columns,",minmax(0,1fr))")}return"repeat(".concat(this.columns,",minmax(").concat(this.minWidth,"px,").concat(this.maxWidth,"px))")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"gap",{get:function(){return"".concat(this.rowGap,"px ").concat(this.columnGap,"px")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"childSize",{get:function(){return this.children.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fullnessLastColumn",{get:function(){var e;return this.columns===(null===(e=this.children[this.childSize-1])||void 0===e?void 0:e.span)},enumerable:!1,configurable:!0}),e.id=function(e){return void 0===e&&(e={}),JSON.stringify(["maxRows","maxColumns","minColumns","maxWidth","minWidth","breakpoints","columnGap","rowGap","colWrap","strictAutoFit"].map((function(t){return e[t]})))},e}();e.Grid=Q,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=formily.grid.umd.production.js.map
