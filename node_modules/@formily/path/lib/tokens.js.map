{"version":3,"file":"tokens.js","sourceRoot":"","sources":["../src/tokens.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  bracketContext,\n  parenContext,\n  bracketArrayContext,\n  bracketDContext,\n  braceContext,\n  destructorContext,\n} from './contexts'\n\ninterface ITokenProps {\n  expectNext?: (next?: Token) => boolean\n  expectPrev?: (prev?: Token) => boolean\n  updateContext?: (prev?: Token) => void\n}\n\nexport type Token = ITokenProps & {\n  flag: string\n}\n\nconst TokenType = (flag: string, props?: ITokenProps): Token => {\n  return {\n    flag,\n    ...props,\n  }\n}\n\nexport const nameTok = TokenType('name', {\n  expectNext(next) {\n    if (this.includesContext(destructorContext)) {\n      return (\n        next === nameTok ||\n        next === commaTok ||\n        next === bracketRTok ||\n        next === braceRTok ||\n        next === colonTok\n      )\n    }\n    return (\n      next === dotTok ||\n      next === commaTok ||\n      next === eofTok ||\n      next === bracketRTok ||\n      next === parenRTok ||\n      next === colonTok ||\n      next === expandTok ||\n      next === bracketLTok\n    )\n  },\n})\nexport const starTok = TokenType('*', {\n  expectNext(next) {\n    return (\n      next === dotTok ||\n      next === parenLTok ||\n      next === bracketLTok ||\n      next === eofTok ||\n      next === commaTok ||\n      next === parenRTok\n    )\n  },\n})\nexport const dbStarTok = TokenType('**', {\n  expectNext(next) {\n    return (\n      next === dotTok ||\n      next === bracketLTok ||\n      next === eofTok ||\n      next === commaTok ||\n      next === parenRTok\n    )\n  },\n})\nexport const dotTok = TokenType('.', {\n  expectNext(next) {\n    return (\n      next === dotTok ||\n      next === nameTok ||\n      next === bracketDLTok ||\n      next === starTok ||\n      next === dbStarTok ||\n      next === bracketLTok ||\n      next === braceLTok ||\n      next === eofTok\n    )\n  },\n  expectPrev(prev) {\n    return (\n      prev === dotTok ||\n      prev === nameTok ||\n      prev === bracketDRTok ||\n      prev === starTok ||\n      prev === parenRTok ||\n      prev === bracketRTok ||\n      prev === expandTok ||\n      prev === braceRTok\n    )\n  },\n})\nexport const bangTok = TokenType('!', {\n  expectNext(next) {\n    return next === nameTok || next === bracketDLTok\n  },\n})\nexport const colonTok = TokenType(':', {\n  expectNext(next) {\n    if (this.includesContext(destructorContext)) {\n      return next === nameTok || next === braceLTok || next === bracketLTok\n    }\n    return next === nameTok || next === bracketDLTok || next === bracketRTok\n  },\n})\n\nexport const braceLTok = TokenType('{', {\n  expectNext(next) {\n    return next === nameTok\n  },\n  expectPrev(prev) {\n    if (this.includesContext(destructorContext)) {\n      return prev === colonTok || prev === commaTok || prev === bracketLTok\n    }\n    return prev === dotTok || prev === colonTok || prev === parenLTok\n  },\n  updateContext() {\n    this.state.context.push(braceContext)\n  },\n})\n\nexport const braceRTok = TokenType('}', {\n  expectNext(next) {\n    if (this.includesContext(destructorContext)) {\n      return (\n        next === commaTok ||\n        next === braceRTok ||\n        next === eofTok ||\n        next === bracketRTok\n      )\n    }\n    return next === dotTok || next === eofTok || next === commaTok\n  },\n  expectPrev(prev) {\n    return prev === nameTok || prev === braceRTok || prev === bracketRTok\n  },\n  updateContext() {\n    this.state.context.pop(braceContext)\n  },\n})\n\nexport const bracketLTok = TokenType('[', {\n  expectNext(next) {\n    if (this.includesContext(destructorContext)) {\n      return (\n        next === nameTok ||\n        next === bracketLTok ||\n        next === braceLTok ||\n        next === bracketRTok\n      )\n    }\n    return (\n      next === nameTok ||\n      next === bracketDLTok ||\n      next === colonTok ||\n      next === bracketLTok ||\n      next === ignoreTok ||\n      next === bracketRTok\n    )\n  },\n  expectPrev(prev) {\n    if (this.includesContext(destructorContext)) {\n      return prev === colonTok || prev === commaTok || prev === bracketLTok\n    }\n    return (\n      prev === starTok ||\n      prev === bracketLTok ||\n      prev === dotTok ||\n      prev === nameTok ||\n      prev === parenLTok ||\n      // never reach\n      prev == commaTok\n    )\n  },\n  updateContext() {\n    this.state.context.push(bracketContext)\n  },\n})\n\nexport const bracketRTok = TokenType(']', {\n  expectNext(next) {\n    if (this.includesContext(destructorContext)) {\n      return (\n        next === commaTok ||\n        next === braceRTok ||\n        next === bracketRTok ||\n        next === eofTok\n      )\n    }\n    return (\n      next === dotTok ||\n      next === eofTok ||\n      next === commaTok ||\n      next === parenRTok ||\n      next === bracketRTok\n    )\n  },\n  updateContext() {\n    if (this.includesContext(bracketArrayContext)) return\n    if (!this.includesContext(bracketContext)) throw this.unexpect()\n    this.state.context.pop()\n  },\n})\n\nexport const bracketDLTok = TokenType('[[', {\n  updateContext() {\n    this.state.context.push(bracketDContext)\n  },\n})\n\nexport const bracketDRTok = TokenType(']]', {\n  updateContext() {\n    if (this.curContext() !== bracketDContext) throw this.unexpect()\n    this.state.context.pop()\n  },\n})\n\nexport const parenLTok = TokenType('(', {\n  expectNext(next) {\n    return (\n      next === nameTok ||\n      next === bracketDLTok ||\n      next === braceLTok ||\n      next === bangTok ||\n      next === bracketLTok\n    )\n  },\n  expectPrev(prev) {\n    return prev === starTok\n  },\n  updateContext() {\n    this.state.context.push(parenContext)\n  },\n})\nexport const parenRTok = TokenType(')', {\n  expectNext(next) {\n    return (\n      next === dotTok ||\n      next === eofTok ||\n      next === commaTok ||\n      next === parenRTok\n    )\n  },\n  updateContext() {\n    if (this.curContext() !== parenContext) throw this.unexpect()\n    this.state.context.pop()\n  },\n})\n\nexport const commaTok = TokenType(',', {\n  expectNext(next) {\n    return (\n      next === nameTok ||\n      next === bracketDLTok ||\n      next === bracketLTok ||\n      next === braceLTok\n    )\n  },\n})\nexport const ignoreTok = TokenType('ignore', {\n  expectNext(next) {\n    return next === bracketDRTok\n  },\n  expectPrev(prev) {\n    return prev == bracketDLTok\n  },\n})\n\nexport const expandTok = TokenType('expandTok', {\n  expectNext(next) {\n    return (\n      next === dotTok ||\n      next === eofTok ||\n      next === commaTok ||\n      next === parenRTok\n    )\n  },\n})\n\nexport const eofTok = TokenType('eof')\n"]}