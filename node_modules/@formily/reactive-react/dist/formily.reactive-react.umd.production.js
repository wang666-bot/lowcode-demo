!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react-is")):"function"==typeof define&&define.amd?define("formily.reactive-react",["exports","react-is"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).Formily=e.Formily||{},e.Formily.ReactiveReact={}))}(this,(function(e){"use strict";!function(){const e={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();var t=function(){return t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},t.apply(this,arguments)};function r(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,u=r.call(e),c=[];try{for(;(void 0===t||t-- >0)&&!(n=u.next()).done;)c.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=u.return)&&r.call(u)}finally{if(o)throw o.error}}return c}"function"==typeof SuppressedError&&SuppressedError;const n=ReactIs;var o={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},u={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},c={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},i={};function a(e){return n.isMemo(e)?c:i[e.$$typeof]||o}i[n.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i[n.Memo]=c;var f=Object.defineProperty,s=Object.getOwnPropertyNames,l=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,y=Object.prototype;var v=function e(t,r,n){if("string"!=typeof r){if(y){var o=d(r);o&&o!==y&&e(t,o,n)}var c=s(r);l&&(c=c.concat(l(r)));for(var i=a(t),v=a(r),m=0;m<c.length;++m){var h=c[m];if(!(u[h]||n&&n[h]||v&&v[h]||i&&i[h])){var R=p(r,h);try{f(t,h,R)}catch(e){}}}}return t},m="undefined"!=typeof document?React.useLayoutEffect:React.useEffect;var h=function(){try{if("undefined"!=typeof self)return self}catch(e){}try{if("undefined"!=typeof window)return window}catch(e){}try{if("undefined"!=typeof global)return global}catch(e){}return Function("return this")()}(),R=h.FinalizationRegistry&&new h.FinalizationRegistry((function(e){var t;return null===(t=null==e?void 0:e.clean)||void 0===t?void 0:t.call(e)})),b=function(){function e(e,t){void 0===t&&(t=1e4),this.token={clean:e},this.expireTime=t}return e.prototype.open=function(e){var t=this;R?R.register(e,this.token,this.token):this.request=setTimeout((function(){var e,r;null===(r=null===(e=t.token)||void 0===e?void 0:e.clean)||void 0===r||r.call(e)}),this.expireTime)},e.prototype.close=function(){R?R.unregister(this.token):clearTimeout(this.request)},e}(),g=function(e){var t=!1;return Promise.resolve(0).then((function(){t?t=!1:e()})),function(){t=!0}},O=function(e){var t=React.useRef(null);t.current=g(e),m((function(){t.current(),e()}))},w=[],T={value:0},F=new Set;function P(){var e=r(React.useState([]),2)[1],t=React.useRef(!1),n=React.useRef(!1);m((function(){return t.current=!0,n.current&&(e([]),n.current=!1),function(){t.current=!1}}),w);var o=React.useCallback((function(){e([])}),w),u=React.useCallback((function(){t.current?0===T.value?o():F.add(o):n.current=!0}),w);return T.value++,O((function(){T.value>0&&T.value--,0===T.value&&F.forEach((function(e){F.delete(e),e()}))})),u}var j=Array.isArray,E=function(e,t){var r=React.useRef(null),n=React.useRef(!1);React.useEffect((function(){n.current=!0;var o=e();return function(){var e,u,c;(n.current=!1,e=r.current,u=t,(c=j(e))===j(u)&&(c?e.length===u.length&&e.every((function(e,t){return e===u[t]})):e===u))?g((function(){n.current||o&&o()})):o&&o()}}),t),r.current=t},x=function(){};function N(){return new x}var S=function(e){var t=React.useRef(null),n=React.useRef(),o=r(React.useState(N),1)[0];return t.current||(t.current=e()),n.current||(n.current=new b((function(){t.current&&t.current.dispose()})),n.current.open(o)),E((function(){return n.current.close(),function(){t.current&&(t.current.dispose(),t.current=null)}}),[]),t.current},k=function(e,t){var r=P();return S((function(){return new Formily.Reactive.Tracker((function(){"function"==typeof(null==t?void 0:t.scheduler)?t.scheduler(r):r()}),null==t?void 0:t.displayName)})).track(e)};function _(e,r){var n=t({forwardRef:!1},r),o=n.forwardRef?React.forwardRef((function(r,o){return k((function(){return e(t(t({},r),{ref:o}))}),n)})):function(t){return k((function(){return e(t)}),n)},u=React.memo(o);return v(u,e),n.displayName&&(u.displayName=n.displayName),u}var D=_((function(e){var t="function"==typeof e.children?e.children():e.children;return React.createElement(React.Fragment,{},t)})),$=P,C=E,q=S,M=O,z=m,A=k;e.Observer=D,e.observer=_,e.unstable_useCompatEffect=C,e.unstable_useCompatFactory=q,e.unstable_useDidUpdate=M,e.unstable_useForceUpdate=$,e.unstable_useLayoutEffect=z,e.unstable_useObserver=A,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=formily.reactive-react.umd.production.js.map
