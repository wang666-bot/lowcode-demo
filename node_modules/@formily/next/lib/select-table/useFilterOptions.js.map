{"version":3,"file":"useFilterOptions.js","sourceRoot":"","sources":["../../src/select-table/useFilterOptions.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,2CAA8B;AAC9B,0CAA6C;AAI7C,SAAS,QAAQ,CAAC,IAAqB,EAAE,MAAc;IACrD,OAAO,OAAO,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAA;AAC9D,CAAC;AAED,SAAS,cAAc,CAAC,MAAW,EAAE,MAAc;IACjD,IAAM,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAA;IAC1B,IAAM,eAAe,GAAG,UAAC,MAAW;QAClC,IAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,IAAI,EAAE,CAAC,CAAA;QACtC,OAAO,IAAI,CAAC,IAAI,CAAC,UAAC,GAAG;YACnB,IAAI,GAAG,KAAK,SAAS,EAAE;gBACrB,OAAO,KAAK,CAAA;aACb;YACD,IAAM,KAAK,GAAG,MAAM,CAAC,GAAG,CAAC,CAAA;YACzB,IAAI,KAAK,CAAC,cAAc,CAAC,KAAK,CAAC;gBAAE,OAAO,KAAK,CAAA;YAC7C,IAAI,GAAG,KAAK,UAAU,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;gBAC9C,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;oBAC7B,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAA;oBACnB,OAAO,eAAe,CAAC,KAAK,CAAC,CAAA;iBAC9B;gBACD,OAAO,QAAQ,CAAC,KAAK,EAAE,MAAM,CAAC,CAAA;aAC/B;YACD,OAAO,KAAK,CAAA;QACd,CAAC,CAAC,CAAA;IACJ,CAAC,CAAA;IACD,OAAO,eAAe,CAAC,MAAM,CAAC,CAAA;AAChC,CAAC;AAED,SAAS,OAAO,CAAI,KAAc;IAChC,IAAI,IAAA,cAAK,EAAC,KAAK,CAAC,EAAE;QAChB,OAAO,KAAK,CAAA;KACb;IACD,OAAO,KAAK,KAAK,SAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAE,CAAA;AAC3C,CAAC;AAED,IAAM,gBAAgB,GAAG,UACvB,OAAc,EACd,WAA+B,EAC/B,YAA4B,EAC5B,aAAuB;IAEvB,OAAA,KAAK,CAAC,OAAO,CAAC;QACZ,IAAI,CAAC,WAAW,IAAI,YAAY,KAAK,KAAK,EAAE;YAC1C,OAAO,OAAO,CAAA;SACf;QACD,IAAM,UAAU,GAAG,IAAA,aAAI,EAAC,YAAY,CAAC;YACnC,CAAC,CAAC,YAAY;YACd,CAAC,CAAC,UAAC,KAAU,EAAE,MAAW,IAAK,OAAA,cAAc,CAAC,MAAM,EAAE,KAAK,CAAC,WAAW,EAAE,CAAC,EAA3C,CAA2C,CAAA;QAE5E,IAAM,QAAQ,GAAG,UAAC,GAAU;YAC1B,IAAM,SAAS,GAAU,EAAE,CAAA;YAC3B,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,OAAO,CAAC,UAAC,IAAI;;gBAChB,IAAI,MAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,QAAQ,0CAAE,MAAM,EAAE;oBAC1B,IAAM,cAAc,GAAG,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;oBAC9C,IAAI,cAAc,CAAC,MAAM,EAAE;wBACzB,SAAS,CAAC,IAAI,uBAAM,IAAI,KAAE,QAAQ,EAAE,cAAc,IAAG,CAAA;qBACtD;yBAAM,IAAI,UAAU,CAAC,WAAW,EAAE,IAAI,CAAC,IAAI,aAAa,KAAK,KAAK,EAAE;wBACnE,yBAAyB;wBACzB,SAAS,CAAC,IAAI,uBAAM,IAAI,KAAE,QAAQ,EAAE,EAAE,IAAG,CAAA;qBAC1C;iBACF;qBAAM,IAAI,UAAU,CAAC,WAAW,EAAE,IAAI,CAAC,EAAE;oBACxC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;iBACrB;YACH,CAAC,CAAC,CAAA;YACF,OAAO,SAAS,CAAA;QAClB,CAAC,CAAA;QAED,OAAO,QAAQ,CAAC,OAAO,CAAC,CAAA;IAC1B,CAAC,EAAE,CAAC,OAAO,EAAE,WAAW,EAAE,YAAY,CAAC,CAAC;AA3BxC,CA2BwC,CAAA;AAEjC,4CAAgB","sourcesContent":["import * as React from 'react'\nimport { isFn, isArr } from '@formily/shared'\n\ntype IFilterOption = boolean | ((option: any, keyword: string) => boolean)\n\nfunction includes(test: React.ReactNode, search: string) {\n  return toArray(test).join('').toUpperCase().includes(search)\n}\n\nfunction includesOption(option: any, search: string) {\n  const searched = new Set()\n  const _includesOption = (option: any) => {\n    const keys = Object.keys(option || {})\n    return keys.some((key) => {\n      if (key === '__level') {\n        return false\n      }\n      const value = option[key]\n      if (React.isValidElement(value)) return false\n      if (key !== 'children' && !searched.has(value)) {\n        if (typeof value === 'object') {\n          searched.add(value)\n          return _includesOption(value)\n        }\n        return includes(value, search)\n      }\n      return false\n    })\n  }\n  return _includesOption(option)\n}\n\nfunction toArray<T>(value: T | T[]): T[] {\n  if (isArr(value)) {\n    return value\n  }\n  return value !== undefined ? [value] : []\n}\n\nconst useFilterOptions = (\n  options: any[],\n  searchValue?: string | string[],\n  filterOption?: IFilterOption,\n  checkStrictly?: boolean\n) =>\n  React.useMemo(() => {\n    if (!searchValue || filterOption === false) {\n      return options\n    }\n    const filterFunc = isFn(filterOption)\n      ? filterOption\n      : (value: any, option: any) => includesOption(option, value.toUpperCase())\n\n    const doFilter = (arr: any[]) => {\n      const filterArr: any[] = []\n      arr?.forEach((item) => {\n        if (item?.children?.length) {\n          const filterChildren = doFilter(item.children)\n          if (filterChildren.length) {\n            filterArr.push({ ...item, children: filterChildren })\n          } else if (filterFunc(searchValue, item) && checkStrictly !== false) {\n            // 父子关系启用时，没有可用子元素，不添加父元素\n            filterArr.push({ ...item, children: [] })\n          }\n        } else if (filterFunc(searchValue, item)) {\n          filterArr.push(item)\n        }\n      })\n      return filterArr\n    }\n\n    return doFilter(options)\n  }, [options, searchValue, filterOption])\n\nexport { useFilterOptions }\n"]}