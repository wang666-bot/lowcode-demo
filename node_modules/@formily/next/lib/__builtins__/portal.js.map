{"version":3,"file":"portal.js","sourceRoot":"","sources":["../../src/__builtins__/portal.tsx"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,6CAAuC;AACvC,uCAAwC;AACxC,8CAA8C;AAC9C,wCAAyC;AACzC,mCAAyE;AAKzE,IAAM,SAAS,GAAG,IAAA,qBAAU,EAAC,IAAI,GAAG,EAAoC,CAAC,CAAA;AAElE,IAAM,oBAAoB,GAAG,UAAC,EAAmB;IACtD,IAAM,MAAM,GAAG,UAAC,KAA4C;QAC1D,IAAI,KAAK,CAAC,EAAE,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,EAAE;YACxC,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,EAAE,IAAI,CAAC,CAAA;SAC9B;QAED,OAAO,CACL,8BAAC,gBAAQ;YACN,KAAK,CAAC,QAAQ;YACf,8BAAC,gBAAQ,QACN;gBACC,IAAI,CAAC,KAAK,CAAC,EAAE;oBAAE,OAAO,IAAI,CAAA;gBAC1B,IAAM,MAAM,GAAG,SAAS,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA;gBACtC,IAAI,MAAM;oBAAE,OAAO,IAAA,wBAAY,EAAC,MAAM,EAAE,QAAQ,CAAC,IAAI,CAAC,CAAA;gBACtD,OAAO,IAAI,CAAA;YACb,CAAC,CACQ,CACF,CACZ,CAAA;IACH,CAAC,CAAA;IACD,MAAM,CAAC,YAAY,GAAG;QACpB,EAAE,IAAA;KACH,CAAA;IACD,OAAO,MAAM,CAAA;AACf,CAAC,CAAA;AAxBY,QAAA,oBAAoB,wBAwBhC;AAED,SAAgB,gBAAgB,CAC9B,IAAiB,EACjB,EAAU;IAEV,SAAS,MAAM,CAAC,QAAkB;QAChC,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;YACrB,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,EAAI,CAAC,CAAA;SAChC;aAAM,IAAI,IAAI,EAAE;YACf,IAAA,eAAW,EAAC,8BAAC,gBAAQ,QAAE,QAAQ,aAAR,QAAQ,uBAAR,QAAQ,EAAI,CAAY,EAAE,IAAI,CAAC,CAAA;SACvD;IACH,CAAC;IAED,SAAS,OAAO;;QACd,IAAI,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;YACrB,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,IAAI,CAAC,CAAA;SACxB;QACD,IAAI,IAAI,EAAE;YACR,IAAM,aAAa,GAAG,IAAA,gBAAY,EAAC,IAAI,CAAC,CAAA;YACxC,IAAI,aAAa,IAAI,IAAI,CAAC,UAAU,EAAE;gBACpC,MAAA,IAAI,CAAC,UAAU,0CAAE,WAAW,CAAC,IAAI,CAAC,CAAA;aACnC;SACF;IACH,CAAC;IAED,OAAO;QACL,MAAM,QAAA;QACN,OAAO,SAAA;KACR,CAAA;AACH,CAAC;AA5BD,4CA4BC","sourcesContent":["import React, { Fragment } from 'react'\nimport { createPortal } from 'react-dom'\nimport { observable } from '@formily/reactive'\nimport { Observer } from '@formily/react'\nimport { render as reactRender, unmount as reactUnmount } from './render'\nexport interface IPortalProps {\n  id?: string | symbol\n}\n\nconst PortalMap = observable(new Map<string | symbol, React.ReactNode>())\n\nexport const createPortalProvider = (id: string | symbol) => {\n  const Portal = (props: React.PropsWithChildren<IPortalProps>) => {\n    if (props.id && !PortalMap.has(props.id)) {\n      PortalMap.set(props.id, null)\n    }\n\n    return (\n      <Fragment>\n        {props.children}\n        <Observer>\n          {() => {\n            if (!props.id) return null\n            const portal = PortalMap.get(props.id)\n            if (portal) return createPortal(portal, document.body)\n            return null\n          }}\n        </Observer>\n      </Fragment>\n    )\n  }\n  Portal.defaultProps = {\n    id,\n  }\n  return Portal\n}\n\nexport function createPortalRoot<T extends React.ReactNode>(\n  host: HTMLElement,\n  id: string\n) {\n  function render(renderer?: () => T) {\n    if (PortalMap.has(id)) {\n      PortalMap.set(id, renderer?.())\n    } else if (host) {\n      reactRender(<Fragment>{renderer?.()}</Fragment>, host)\n    }\n  }\n\n  function unmount() {\n    if (PortalMap.has(id)) {\n      PortalMap.set(id, null)\n    }\n    if (host) {\n      const unmountResult = reactUnmount(host)\n      if (unmountResult && host.parentNode) {\n        host.parentNode?.removeChild(host)\n      }\n    }\n  }\n\n  return {\n    render,\n    unmount,\n  }\n}\n"]}