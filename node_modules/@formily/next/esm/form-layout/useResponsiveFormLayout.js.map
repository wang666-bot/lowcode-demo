{"version":3,"file":"useResponsiveFormLayout.js","sourceRoot":"","sources":["../../src/form-layout/useResponsiveFormLayout.ts"],"names":[],"mappings":"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","sourcesContent":["import { useRef, useState, useEffect } from 'react'\nimport { isArr, isValid } from '@formily/shared'\n\ninterface IProps {\n  breakpoints?: number[]\n  layout?:\n    | 'vertical'\n    | 'horizontal'\n    | 'inline'\n    | ('vertical' | 'horizontal' | 'inline')[]\n  labelCol?: number | number[]\n  wrapperCol?: number | number[]\n  labelAlign?: 'right' | 'left' | ('right' | 'left')[]\n  wrapperAlign?: 'right' | 'left' | ('right' | 'left')[]\n  [props: string]: any\n}\n\ninterface ICalcBreakpointIndex {\n  (originalBreakpoints: number[], width: number): number\n}\n\ninterface ICalculateProps {\n  (target: HTMLElement, props: IProps): IProps\n}\n\ninterface IUseResponsiveFormLayout {\n  (props: IProps): {\n    ref: React.MutableRefObject<HTMLDivElement>\n    props: any\n  }\n}\n\nconst calcBreakpointIndex: ICalcBreakpointIndex = (breakpoints, width) => {\n  for (let i = 0; i < breakpoints.length; i++) {\n    if (width <= breakpoints[i]) {\n      return i\n    }\n  }\n}\n\nconst calcFactor = <T>(value: T | T[], breakpointIndex: number): T => {\n  if (Array.isArray(value)) {\n    if (breakpointIndex === -1) return value[0]\n    return value[breakpointIndex] ?? value[value.length - 1]\n  } else {\n    return value\n  }\n}\n\nconst factor = <T>(value: T | T[], breakpointIndex: number): T =>\n  isValid(value) ? calcFactor(value as any, breakpointIndex) : value\n\nconst calculateProps: ICalculateProps = (target, props) => {\n  const { clientWidth } = target\n  const {\n    breakpoints,\n    layout,\n    labelAlign,\n    wrapperAlign,\n    labelCol,\n    wrapperCol,\n    ...otherProps\n  } = props\n  const breakpointIndex = calcBreakpointIndex(breakpoints, clientWidth)\n\n  return {\n    layout: factor(layout, breakpointIndex),\n    labelAlign: factor(labelAlign, breakpointIndex),\n    wrapperAlign: factor(wrapperAlign, breakpointIndex),\n    labelCol: factor(labelCol, breakpointIndex),\n    wrapperCol: factor(wrapperCol, breakpointIndex),\n    ...otherProps,\n  }\n}\n\nexport const useResponsiveFormLayout: IUseResponsiveFormLayout = (props) => {\n  const ref = useRef<HTMLDivElement>(null)\n  const { breakpoints } = props\n  if (!isArr(breakpoints)) {\n    return { ref, props }\n  }\n  const [layoutProps, setLayout] = useState<IProps>(props)\n\n  const updateUI = () => {\n    if (ref.current) {\n      setLayout(calculateProps(ref.current, props))\n    }\n  }\n\n  useEffect(() => {\n    const observer = () => {\n      updateUI()\n    }\n    const resizeObserver = new ResizeObserver(observer)\n    if (ref.current) {\n      resizeObserver.observe(ref.current)\n    }\n    updateUI()\n    return () => {\n      resizeObserver.disconnect()\n    }\n  }, [])\n\n  return {\n    ref,\n    props: layoutProps,\n  }\n}\n"]}